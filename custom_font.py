import pygame

def make_font():
    d = {}
    
    # Uppercase
    d['A'] = [" ### ", "#   #", "#   #", "#####", "#   #", "#   #", "#   #"]
    d['B'] = ["#### ", "#   #", "#   #", "#### ", "#   #", "#   #", "#### "]
    d['C'] = [" ####", "#    ", "#    ", "#    ", "#    ", "#    ", " ####"]
    d['D'] = ["#### ", "#   #", "#   #", "#   #", "#   #", "#   #", "#### "]
    d['E'] = ["#####", "#    ", "#    ", "#### ", "#    ", "#    ", "#####"]
    d['F'] = ["#####", "#    ", "#    ", "#### ", "#    ", "#    ", "#    "]
    d['G'] = [" ####", "#    ", "#    ", "# ###", "#   #", "#   #", " ####"]
    d['H'] = ["#   #", "#   #", "#   #", "#####", "#   #", "#   #", "#   #"]
    d['I'] = ["###", " # ", " # ", " # ", " # ", " # ", "###"]
    d['J'] = ["    #", "    #", "    #", "    #", "#   #", "#   #", " ### "]
    d['K'] = ["#   #", "#  # ", "# #  ", "##   ", "# #  ", "#  # ", "#   #"]
    d['L'] = ["#    ", "#    ", "#    ", "#    ", "#    ", "#    ", "#####"]
    d['M'] = ["#   #", "## ##", "# # #", "# # #", "#   #", "#   #", "#   #"]
    d['N'] = ["#   #", "##  #", "##  #", "# # #", "#  ##", "#  ##", "#   #"]
    d['O'] = [" ### ", "#   #", "#   #", "#   #", "#   #", "#   #", " ### "]
    d['P'] = ["#### ", "#   #", "#   #", "#### ", "#    ", "#    ", "#    "]
    d['Q'] = [" ### ", "#   #", "#   #", "#   #", "# # #", "#  ##", " ####"]
    d['R'] = ["#### ", "#   #", "#   #", "#### ", "# #  ", "#  # ", "#   #"]
    d['S'] = [" ####", "#    ", "#    ", " ### ", "    #", "    #", "#### "]
    d['T'] = ["#####", "  #  ", "  #  ", "  #  ", "  #  ", "  #  ", "  #  "]
    d['U'] = ["#   #", "#   #", "#   #", "#   #", "#   #", "#   #", " ### "]
    d['V'] = ["#   #", "#   #", "#   #", "#   #", "#   #", " # # ", "  #  "]
    d['W'] = ["#   #", "#   #", "#   #", "# # #", "# # #", "## ##", "#   #"]
    d['X'] = ["#   #", "#   #", " # # ", "  #  ", " # # ", "#   #", "#   #"]
    d['Y'] = ["#   #", "#   #", " # # ", "  #  ", "  #  ", "  #  ", "  #  "]
    d['Z'] = ["#####", "    #", "   # ", "  #  ", " #   ", "#    ", "#####"]
    
    # Lowercase
    d['a'] = ["    ", "    ", " ###", "   #", "####", "#  #", "####"]
    d['b'] = ["#   ", "#   ", "### ", "#  #", "#  #", "#  #", "### "]
    d['c'] = ["    ", "    ", " ###", "#   ", "#   ", "#   ", " ###"]
    d['d'] = ["   #", "   #", " ###", "#  #", "#  #", "#  #", " ###"]
    d['e'] = ["    ", "    ", " ###", "#  #", "####", "#   ", " ###"]
    d['f'] = ["  ##", " #  ", "### ", " #  ", " #  ", " #  ", " #  "]
    d['g'] = ["    ", "    ", " ###", "#  #", " ###", "   #", "### "]
    d['h'] = ["#   ", "#   ", "### ", "#  #", "#  #", "#  #", "#  #"]
    d['i'] = ["#", " ", "#", "#", "#", "#", "#"]
    d['j'] = [" #", "  ", " #", " #", " #", " #", "# "]
    d['k'] = ["#  ", "#  ", "# #", "## ", "# #", "# #", "# #"]
    d['l'] = ["#", "#", "#", "#", "#", "#", "#"]
    d['m'] = ["     ", "     ", "## ##", "# # #", "# # #", "# # #", "# # #"]
    d['n'] = ["    ", "    ", "### ", "#  #", "#  #", "#  #", "#  #"]
    d['o'] = ["    ", "    ", " ## ", "#  #", "#  #", "#  #", " ## "]
    d['p'] = ["    ", "    ", "### ", "#  #", "### ", "#   ", "#   "]
    d['q'] = ["    ", "    ", " ###", "#  #", " ###", "   #", "   #"]
    d['r'] = ["    ", "    ", " ###", " #  ", " #  ", " #  ", " #  "]
    d['s'] = ["    ", "    ", " ###", "#   ", " ## ", "   #", "### "]
    d['t'] = [" # ", "###", " # ", " # ", " # ", " # ", "  #"]
    d['u'] = ["    ", "    ", "#  #", "#  #", "#  #", "#  #", " ###"]
    d['v'] = ["    ", "    ", "#  #", "#  #", "#  #", " ## ", " ## "]
    d['w'] = ["     ", "     ", "#   #", "# # #", "# # #", "## ##", " # # "]
    d['x'] = ["    ", "    ", "#  #", " ## ", " ## ", "#  #", "#  #"]
    d['y'] = ["    ", "    ", "#  #", "#  #", " ###", "   #", "### "]
    d['z'] = ["    ", "    ", "####", "  # ", " #  ", "#   ", "####"]
    
    # Numbers
    d['0'] = [" ### ", "#   #", "#  ##", "# # #", "##  #", "#   #", " ### "]
    d['1'] = [" ##", "  #", "  #", "  #", "  #", "  #", "###"]
    d['2'] = [" ### ", "#   #", "    #", " ### ", "#    ", "#    ", "#####"]
    d['3'] = [" ### ", "#   #", "    #", "  ## ", "    #", "#   #", " ### "]
    d['4'] = ["   # ", "  ## ", " # # ", "#  # ", "#####", "   # ", "   # "]
    d['5'] = ["#####", "#    ", "#### ", "    #", "    #", "#   #", " ### "]
    d['6'] = [" ### ", "#    ", "#    ", "#### ", "#   #", "#   #", " ### "]
    d['7'] = ["#####", "    #", "   # ", "  #  ", " #   ", " #   ", " #   "]
    d['8'] = [" ### ", "#   #", "#   #", " ### ", "#   #", "#   #", " ### "]
    d['9'] = [" ### ", "#   #", "#   #", " ####", "    #", "    #", " ### "]
    
    # Punctuation & Specials
    d['!'] = ["#", "#", "#", "#", "#", " ", "#"]
    d['?'] = [" ### ", "#   #", "    #", "  ## ", "  #  ", "     ", "  #  "]
    d['.'] = [" ", " ", " ", " ", " ", " ", "#"]
    d[','] = [" ", " ", " ", " ", " ", " #", "# "]
    d["'"] = ["#", "#", " ", " ", " ", " ", " "]
    d[' '] = ["    ", "    ", "    ", "    ", "    ", "    ", "    "]
    d['-'] = ["   ", "   ", "   ", "###", "   ", "   ", "   "]
    d['_'] = ["     ", "     ", "     ", "     ", "     ", "     ", "#####"]
    d['('] = ["  #", " # ", "#  ", "#  ", "#  ", " # ", "  #"]
    d[')'] = ["#  ", " # ", "  #", "  #", "  #", " # ", "#  "]
    d['>'] = ["#  ", " # ", "  #", "   #", "  #", " # ", "#  "]
    d['<'] = ["   #", "  # ", " #  ", "#   ", " #  ", "  # ", "   #"]
    d['\\'] = ["#   ", "#   ", " #  ", "  # ", "  # ", "   #", "   #"]
    d['`'] = ["##", "  ", "  ", "  ", "  ", "  ", "  "]
    
    return d

FONT_DICT = make_font()
UNKNOWN_CHAR = FONT_DICT['?']

class CustomPixelFont:
    def __init__(self, scale):
        self.scale = scale

    def render(self, text, antialias, color):
        # Calculate total width
        width = 0
        height = 7
        
        for char in text:
            bitmap = FONT_DICT.get(char, UNKNOWN_CHAR)
            char_width = len(bitmap[0])
            width += char_width + 1
            
        # create surface with alpha
        surface = pygame.Surface((width * self.scale, height * self.scale), pygame.SRCALPHA)
        
        x_offset = 0
        for char in text:
            bitmap = FONT_DICT.get(char, UNKNOWN_CHAR)
            char_width = len(bitmap[0])
            
            for y, row in enumerate(bitmap):
                for x, col in enumerate(row):
                    if col == '#':
                        rect = ((x_offset + x) * self.scale, y * self.scale, self.scale, self.scale)
                        pygame.draw.rect(surface, color, rect)
            
            x_offset += char_width + 1
            
        return surface

